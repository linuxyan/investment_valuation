# 股票数据分析与估值系统 - 用户使用说明

## 系统简介

本系统是一个专业的股票数据分析工具，能够自动从雪球API获取股票数据，进行多种估值指标计算，并生成详细的估值报告。

## 系统要求

### 硬件要求
- 内存：至少2GB
- 存储空间：至少100MB可用空间

### 软件要求
- Python 3.7或更高版本
- 操作系统：Windows/Linux/macOS

## 安装步骤

### 1. 下载系统文件
将整个项目文件夹下载到本地。

### 2. 安装Python依赖
```bash
pip install -r requirements.txt
```

### 3. 配置雪球Cookie
编辑 `config.py` 文件，在 `HEADERS` 部分配置你的雪球Cookie：

```python
HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...',
    # ... 其他头部
    'Cookie': 'xq_a_token=你的token值; 其他cookie信息'
}
```

**获取Cookie方法：**
1. 登录雪球网站(xueqiu.com)
2. 按F12打开开发者工具
3. 在Network标签页中任意请求的Headers中找到Cookie
4. 复制整个Cookie字符串

### 4. 准备股票数据
确保 `data/stocks_data.csv` 文件包含你要分析的股票代码：

```csv
股票代码,股票名称,市盈率标准差倍数
600519,贵州茅台,1.0
hk00700,腾讯控股,1.0
000858,五粮液,1.0
...
```

## 使用方法

### 基本运行方式

#### 方法一：使用主程序（推荐）
```bash
# 完整运行（获取数据+处理数据）
python main.py

# 仅获取数据
python main.py --mode fetch

# 仅处理数据
python main.py --mode process

# 设置请求间隔（避免API限制）
python main.py --delay 2.0
```

#### 方法二：使用简化脚本
```bash
python run.py
```

### 运行参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| --mode | 运行模式：fetch/process/all | all |
| --delay | API请求间隔时间（秒） | 1.0 |

## 运行结果

### 数据库文件
- 位置：`data/db/stock_valuation.db`
- 包含：原始数据和估值结果

### JSON输出文件
- 位置：`data/output/` 目录
- 文件：
  - `all_stocks_valuation.json` - 所有股票汇总
  - `{股票代码}_valuation.json` - 单个股票详细数据

### 日志文件
- 位置：`stock_valuation.log`
- 内容：运行详细日志

## 数据解读

### 估值指标说明

1. **当前收盘价 (current_close)**
   - 股票的最新收盘价格

2. **当前市盈率 (current_pe)**
   - 股票的最新市盈率(TTM)

3. **5年平均市盈率 (avg_pe_5y)**
   - 过去5年的平均市盈率

4. **5年市盈率标准差 (std_pe_5y)**
   - 过去5年市盈率的波动程度

5. **市盈率90%分位 (pe_percentile_90)**
   - 过去5年市盈率的90%分位值

6. **合理市盈率 (reasonable_pe)**
   - 基于历史数据计算的合理估值水平

7. **市盈率估值 (pe_valuation)**
   - 当前估值相对于合理水平的倍数
   - >1表示高估，<1表示低估

8. **买点价格 (buy_point)**
   - 建议的买入价格

9. **买点百分比 (buy_point_percentage)**
   - 当前价格相对于买点的溢价百分比

### 投资建议参考

| 指标 | 判断标准 | 建议 |
|------|----------|------|
| pe_valuation | < 0.8 | 严重低估，建议买入 |
| pe_valuation | 0.8-1.0 | 合理估值，可考虑买入 |
| pe_valuation | 1.0-1.2 | 轻度高估，谨慎持有 |
| pe_valuation | > 1.2 | 明显高估，建议卖出 |

## 高级功能

### 自定义股票列表
编辑 `data/stocks_data.csv` 文件，添加或删除股票代码：

```csv
股票代码,股票名称,市盈率标准差倍数
600519,贵州茅台,1.0
hk00700,腾讯控股,1.0
000858,五粮液,1.0
# 添加新的股票...
```

### 自定义估值参数
编辑 `config.py` 文件中的相关参数：

```python
# 交易天数配置
TRADING_DAYS_PER_YEAR = 250

# 买点计算系数
BUY_POINT_RATIO_HIGH = 0.5    # 合理PE≥20时的系数
BUY_POINT_RATIO_LOW = 0.6     # 合理PE<20时的系数
```

### 定时自动运行（Linux/macOS）
使用crontab设置定时任务：

```bash
# 每天上午9点运行
0 9 * * * cd /path/to/stock_valuation && python main.py
```

## 故障排除

### 常见问题

1. **API请求失败**
   - 检查网络连接
   - 验证Cookie是否有效
   - 增加请求间隔时间

2. **数据计算错误**
   - 检查股票数据是否完整
   - 验证数据格式是否正确

3. **数据库错误**
   - 检查文件权限
   - 确认磁盘空间充足

### 日志查看
查看 `stock_valuation.log` 文件获取详细错误信息。

## 数据更新

### 增量更新
系统支持增量更新，只会获取缺失的数据。

### 全量更新
删除数据库文件后重新运行，进行全量数据获取。

## 注意事项

### 数据时效性
- 股票数据实时更新，建议定期运行
- 估值结果基于历史数据，仅供参考

### 投资风险
- 本系统计算结果仅供参考
- 投资决策需结合多方面因素
- 市场有风险，投资需谨慎

### 法律声明
- 本系统仅供学习和研究使用
- 请遵守相关法律法规
- 尊重数据源的使用条款

## 技术支持

如遇到问题，请：
1. 查看日志文件获取错误信息
2. 检查系统要求是否满足
3. 验证配置参数是否正确

## 版本更新

系统会定期更新，请关注项目更新通知。